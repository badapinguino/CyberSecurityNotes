# Web App Vulnerability Scanning with WMAP

<figure><img src="../../.gitbook/assets/image (682).png" alt=""><figcaption></figcaption></figure>

```
service postgresql start
msfconsole
workspace -a Web_Scanning
setg RHOSTS 192.157.89.3
load wmap
wmap_sites -a 192.157.89.3
wmap_targets -t http://192.157.89.3
wmap_sites -l
wmap_targets -l
```

<figure><img src="../../.gitbook/assets/image (686).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (687).png" alt=""><figcaption></figcaption></figure>

## Eseguire un modulo Metasploit con WMAP

```
wmap_run -h
wmap_run -t   //identifica tutti i moduli auxiliary compatibili con il target
wmap_run -e   //esegue i moduli compatibili trovati prima
```

wmap\_run -t va a cercare tutti i moduli auxiliary che possono essere utili per il nostro target. Va a usare tutti i moduli che possono essere utili per il nostro target e webserver, non tutti in generale.

<figure><img src="../../.gitbook/assets/image (688).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (689).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (690).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (691).png" alt=""><figcaption></figcaption></figure>

Ad esempio qui sotto sono evidenziati gli utili moduli per testae sql injection e path traversal:

<figure><img src="../../.gitbook/assets/image (692).png" alt=""><figcaption></figcaption></figure>

Ora con wmap\_run -e va ad eseguire tutti i 39 moduli identificati precedentemente e compatibili con il nostro target.

<figure><img src="../../.gitbook/assets/image (693).png" alt=""><figcaption></figcaption></figure>

Va ad automatizzare quanto visto nella http enumeration.

<figure><img src="../../.gitbook/assets/image (694).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (695).png" alt=""><figcaption></figcaption></figure>

Terminato il test possiamo vedere che ha trovato molte informazioni.

<figure><img src="../../.gitbook/assets/image (696).png" alt=""><figcaption></figcaption></figure>

Ad esempio vediamo le chiamate HTTP supportate, il file robots.txt che identifica le due cartelle interessanti data e secure.

Poi vengono identificate le varie cartelle e file trovati sul server.

<figure><img src="../../.gitbook/assets/image (697).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (698).png" alt=""><figcaption></figcaption></figure>

Ha cercato di testare l'http put nella cartella root del sito (/) ma ha restituito errore, però riutilizzeremo questo modulo per testare le altre chiamate/metodi HTTP supportate che abbiamo visto sopra.

<figure><img src="../../.gitbook/assets/image (699).png" alt=""><figcaption></figcaption></figure>

Non è vulnerabile a SQLi ecc...

## Listare tutte le vulnerabilità del target

```
wmap_vulns -h
wmap_vulns -l
```

<figure><img src="../../.gitbook/assets/image (700).png" alt=""><figcaption></figcaption></figure>

&#x20;in questo caso non sono proprio vulnerabilità ma più che altro tutte le directory identificate.

Nell'output precedente l'informazione più utile che possiamo identificare sono i metodi http supportati.

Se riuscissimo a trovare una cartella dove è possibile inserire un file tramite HTTP PUT sarebbe ideale.

Quindi proviamo a trovarla:

## Identificare cartelle con HTTP PUT abilitata

<figure><img src="../../.gitbook/assets/image (701).png" alt=""><figcaption></figcaption></figure>

```
use auxiliary/scanner/http/options
show_options
run
```

### Andiamo a cercare cartelle dove la put è abilitata

```
use auxiliary/scanner/http/http_put
show options
set PATH /data/
run
```

<figure><img src="../../.gitbook/assets/image (702).png" alt=""><figcaption></figcaption></figure>

Questo ci dice che non è possibile caricare file nella cartella root del webserver.

Però avevamo prima visto che c'era una cartella nascosta chiamata /data che poteva essere interessante, proviamo con quella:

<figure><img src="../../.gitbook/assets/image (703).png" alt=""><figcaption></figcaption></figure>

In questo caso dato che il server è misconfigurato e si può uploadare dovremmo caricare sul server un payload con reverse shell.



Mentre noi controlliamo solo che effettivamente il file sia stato caricato nel server web:

<figure><img src="../../.gitbook/assets/image (704).png" alt=""><figcaption></figcaption></figure>

Quindi siamo riusciti a trovare una vulnerabilità con  wmap e capire come sfruttarla.

wmap è molto utile per velocizzare queste operazioni di ricerca vulnerabilità e misconfigurazioni.



Prossimi passi di un attaccante/pentester: caricare una reverse shell payload in PHP sul webserver e visitare il sito da browser per fare in modo che venga eseguito il file e ci troveremmo una connessione reverse shell attiva sul nostro netcat listener.

#### Modifichiamo il file da caricare per fare un ulteriore test con put su /data/

<figure><img src="../../.gitbook/assets/image (1040).png" alt=""><figcaption></figcaption></figure>

Di potrebbe caricare nel FILEDATA un php meterpreter module, che una volta caricato ed eseguito tramite curl o browser web aprirebbe una connessione al PC attaccante.
