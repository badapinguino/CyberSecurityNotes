# Exploiting SUID Binaries

<figure><img src="../../.gitbook/assets/image (975).png" alt=""><figcaption></figcaption></figure>

Ad esempio il sudo binary è un SUID, è dell'utente root e quando eseguito da un altro utente consente di usare i permessi di root.

<figure><img src="../../.gitbook/assets/image (976).png" alt=""><figcaption></figcaption></figure>

## Identificazione di un file con SUID permission

Anche in questo caso non abbiamo bisogno di trovare un modo per fare l'accesso al target. Ma ci viene fornito per questo laboratorio un accesso alla macchina target come utente non privilegiato.

```
whoami
groups student
pwd
ls -al
```

<figure><img src="../../.gitbook/assets/image (977).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (978).png" alt=""><figcaption></figcaption></figure>

Nella home dell'utente ci sono due file: greetings e welcome. Welcome appartiene all'utente root ma possiamo eseguirlo dato che ci sono le x. Ma se poniamo attenzione alla s, quella s è l'SUID permission è applicata a questo file.

<figure><img src="../../.gitbook/assets/image (979).png" alt=""><figcaption></figcaption></figure>

### Approfondiamo ora questo file con SUID e troviamo come sfruttarlo

```
file welcome
strings welcome //notiamo una chiamata al binary greetings
```

<figure><img src="../../.gitbook/assets/image (980).png" alt=""><figcaption></figcaption></figure>

Standard ELF Binary per linux, e ci dà informazioni su cosa viene richiamato da questo file.\
In alcuni casi possono esserci dei missing shared object che possiamo sfruttare per eseguire azioni malevole, ma in questo caso non ce ne sono.

<figure><img src="../../.gitbook/assets/image (981).png" alt=""><figcaption></figcaption></figure>

Facciamo un po' di static analysis di base osservando le stringhe nel file welcome.

<figure><img src="../../.gitbook/assets/image (982).png" alt=""><figcaption></figcaption></figure>

Dalle prime righe si può vedere che chiama due static binaries, uno è quello che avevamo individuato dal comando file.\
Poi chiama setuid, e poi chiama il binary greetings.

Quindi, se noi modifichiamo il file greetings possiamo magari chiamare un bash, perché il comando specificato in greetings verrà eseguito come root (per via di SUID impostato).

### Creiamo il nostro file greetings binary

```
rm greetings //eliminiamo il file greetings per sostituirlo
cp /bin/bash greetings
ls
./welcome
id
whoami
cat /etc/shadow
```

<figure><img src="../../.gitbook/assets/image (983).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (984).png" alt=""><figcaption></figcaption></figure>

